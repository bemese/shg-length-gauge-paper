\section{Introduction}\label{intro}
%nonlocal, not non-local

Nonlinear optics has been a relevant topic in physics research for the past 
fifty years and has gained a wide range of applications in 
many areas of technology and research. In material science,
Second-harmonic generation (SHG) is of particular importance.
It was one of the first nonlinear processes to be observed and is now one
of the most used. It has proven to be very effective as an 
optical probe for material surface and interfaces. 
\cite{hughesPRB96, 
     guyot-sionnestPRB88, 
     lupkeSSR99, 
     downerPSSA01, 
     shenAPB99, 
     shenNAT89, 
     chenPRL81, 
     maytorenaPRB98}
SHG surface spectroscopy is a crucial tool for research and development
in microelectronics, semiconductors, nanomaterials, and many more recent 
areas of great scientific and commercial interest.

Numerous mathematical frameworks have been developed to study the 
nonlinear optical response of materials; 
in the context of this paper, we note two in particular. 
The first, called the ``velocity gauge'' or 
``$\mathbf{v}\cdot\mathbf{A}$ gauge,'' features in early 
research in this field. 
Butcher and McLean\cite{butcherPOPS63}, and 
Aspnes\cite{aspnesPRB72} 
laid the initial groundwork by deriving explicit expressions for the 
nonlinear susceptibility tensor. However, these either diverged at 
low frequencies or were limited to zincblende crystal structures. 
A few decades later, 
Ghahramani \emph{et al}.\cite{ghahramaniPRB91} 
realized a full-band-structure calculation for Si/Ge superlattices and 
found significant surface SHG while providing proof that the expressions 
do not diverge at low frequencies for clean, cold semiconductors. 
Sipe \emph{et al}.\cite{sipePRB93}
separated the interband and intraband one-electron contributions 
of the susceptibility tensor and further verified the non-divergent behavior. 
Levine\cite{levinePRB94} 
introduced the scissors operator within the Local Density Approximation
(LDA) and found good agreement with experimental results. 
The second, called the ``length gauge'' or 
``$\mathbf{r}\cdot\mathbf{E}$ gauge'' has various advantages over 
the velocity gauge. 
Aversa and Sipe\cite{aversaPRB95} 
presented divergence free expressions for the susceptibility tensor using 
the length gauge that are significantly easier to derive and calculate. 
Cabellos \emph{et al}.\cite{cabellosPRB09} 
elaborated a detailed derivation of the length gauge 
formalism and a comparison with the velocity gauge for bulk GaAs. They 
proved that the results are indeed gauge-invariant. 
This presents a strong case for using the length over the velocity gauge 
for more generalized, and less expensive calculations of the nonlinear
response of a system.

The inclusion of nonlocal effects, such as the scissors correction, has been
correctly included in both the velocity and length guage schemes. 
In the former, both 
Rashkeev \emph{et al}.\cite{rashkeevPRB98} and 
Hughes and Sipe\cite{hughesPRB96} 
accounted for the scissors correction when calculating the nonlinear 
susceptibility tensor.
Leitsmann \emph{et al}.\cite{leitsmannPRB05} 
included excitonic and local field interactions working with GaAs.
Nastos \emph{et al}.\cite{nastosPRB05} demonstrated the correct 
way to calculate the nonlinear response using the scissored Hamiltonian 
in the length gauge, providing better agreement with experiment. 

Concerning the optical response of surfaces and interfaces,
Mendoza and Moch\'an\cite{mendozaPRB96} produced an early review of 
theoretical SHG spectra from surfaces. 
Arzate and Mendoza\cite{arzatePRB01} improved upon that work and
went into a detailed analysis of the different contributions to the 
SHG spectra of a surface and the nuanced relationship between bulk, 
surface, interband, intraband, $1\omega$ and $2\omega$ terms. 
Calculated surface SHG spectra using these schemes coincide with experimental
results in both the velocity gauge
\cite{mendozaPRB01,mendozaPRL98,reiningPRB94} and the length gauge approach
\cite{sharmaPRB03}. 
Perhaps of more relevance to this work, 
Mendoza \emph{et al}.\cite{mendozaPRB06} and 
Mej√≠a \emph{et al}.\cite{mejiaRMF04} developed a layer-by-layer analysis for 
the linear and nonlinear responses of semiconductor systems. This model
allows for obtaining results from selected regions within a slab or bulk,
including the surface.
More recently, 
Trolle \emph{et al}.\cite{trollePRB14} 
elaborate on a new theoretical model for surface SHG of 
mono-layer MoS$_{2}$. Their approach is based on the tight-binding model 
fitted to GW results and include excitonic effects from the 
Bethe-Salpeter exciton picture. However, this new model is not 
\emph{ab initio} and has no consideration for a layered approach.

The most complete approach will be a combination of the different techniques 
that lead to more efficient and accurate calculations. Therefore,
the goal of this paper is to present newly derived expressions for the 
nonlinear susceptibility tensor $\chi^{abc}(-2\omega;\omega,\omega)$ 
in the length gauge formalism, 
that include nonlocal terms from the scissors approximation 
and the spatial contribution from the pseudopotentials, and a 
layer-by-layer approach convenient for surface SHG calculations. We are
able to divide the resulting tensor in interband, intraband, $1\omega$, and 
$2\omega$ contributions. This approach is unprecedented and yet produces 
results that are in total agreement with the literature.

The paper is organized as follows. 
In Sec. \ref{theory} we present the 
relevant steps for deriving the surface second-order susceptibility tensor 
within the length gauge formalism. This derivation includes the addition of 
the nonlocal terms mentioned above and a layer-by-layer analysis that have 
been absent in previous works. 
In Sec. \ref{results} we show the results of this 
reformulation with a layer-by-layer study of a clean Si(111) surface with a 
$2 \times 1$ reconstruction. These calculations are done with \emph{ab initio}
programs based on density-functional theory (DFT) within the local-density 
approximation (LDA), using Troullier-Martins pseudopotentials. We compare 
results from before and after adding the different nonlocal contributions.
Finally, in Sec. \ref{conclusions} we submit our conclusions.
